/*
 * @Description:
 * @Date: 2024-01-17 17:52:09
 * @LastEditTime: 2024-05-11 13:34:38
 * @FilePath: \webpack-teste:\others\jsplumb-test\src\views\echarts\chartEdit\mockData.js
 */

// export const mockDataSet = {
//   code: 0,
//   msg: '请求成功',
//   data: [
//     {
//       id: null,
//       dataId: null,
//       columnId: 'a64d069e7d5deba511e5a11fb',
//       columnName: '事业部',
//       lowerColumnName: null,
//       upperColumnName: null,
//       columnTypeName: 'string',
//       columnClassName: 'java.lang.String',
//       scale: null,
//       precision: null,
//       columnType: null,
//       cnName: '事业部',
//       enName: '事业部',
//       customColumnType: 'string',
//       fieldPermission: 'Y',
//       srcValue: null,
//       tableName: null,
//       isHidden: 0,
//       joinDataId: null,
//       sortBy: 0,
//       level: null,
//       levelName: null,
//       parentId: null,
//       isLeaf: null,
//     },
//     {
//       id: null,
//       dataId: null,
//       columnId: 'a64d069e7d5deba511e5a11fc',
//       columnName: '产品线',
//       lowerColumnName: null,
//       upperColumnName: null,
//       columnTypeName: 'string',
//       columnClassName: 'java.lang.String',
//       scale: null,
//       precision: null,
//       columnType: null,
//       cnName: '产品线',
//       enName: '产品线',
//       customColumnType: 'string',
//       fieldPermission: 'Y',
//       srcValue: null,
//       tableName: null,
//       isHidden: 0,
//       joinDataId: null,
//       sortBy: 0,
//       level: null,
//       levelName: null,
//       parentId: null,
//       isLeaf: null,
//     },
//     {
//       id: null,
//       dataId: null,
//       columnId: 'a64d069e7d5deba511e5a11fd',
//       columnName: '销售部门',
//       lowerColumnName: null,
//       upperColumnName: null,
//       columnTypeName: 'string',
//       columnClassName: 'java.lang.String',
//       scale: null,
//       precision: null,
//       columnType: null,
//       cnName: '销售部门',
//       enName: '销售部门',
//       customColumnType: 'string',
//       fieldPermission: 'Y',
//       srcValue: null,
//       tableName: null,
//       isHidden: 0,
//       joinDataId: null,
//       sortBy: 0,
//       level: null,
//       levelName: null,
//       parentId: null,
//       isLeaf: null,
//     },
//     {
//       id: null,
//       dataId: null,
//       columnId: 'a64d069e7d5deba511e5a11fe',
//       columnName: '立项编号',
//       lowerColumnName: null,
//       upperColumnName: null,
//       columnTypeName: 'string',
//       columnClassName: 'java.lang.String',
//       scale: null,
//       precision: null,
//       columnType: null,
//       cnName: '立项编号',
//       enName: '立项编号',
//       customColumnType: 'string',
//       fieldPermission: 'Y',
//       srcValue: null,
//       tableName: null,
//       isHidden: 0,
//       joinDataId: null,
//       sortBy: 0,
//       level: null,
//       levelName: null,
//       parentId: null,
//       isLeaf: null,
//     },
//     {
//       id: null,
//       dataId: null,
//       columnId: 'a64d069e7d5deba511e5a11ff',
//       columnName: '产品料号',
//       lowerColumnName: null,
//       upperColumnName: null,
//       columnTypeName: 'string',
//       columnClassName: 'java.lang.String',
//       scale: null,
//       precision: null,
//       columnType: null,
//       cnName: '产品料号',
//       enName: '产品料号',
//       customColumnType: 'string',
//       fieldPermission: 'Y',
//       srcValue: null,
//       tableName: null,
//       isHidden: 0,
//       joinDataId: null,
//       sortBy: 0,
//       level: null,
//       levelName: null,
//       parentId: null,
//       isLeaf: null,
//     },
//     {
//       id: null,
//       dataId: null,
//       columnId: 'a64d069e7d5deba511e5a1200',
//       columnName: '出货时间',
//       lowerColumnName: null,
//       upperColumnName: null,
//       columnTypeName: 'date',
//       columnClassName: 'java.sql.Date',
//       scale: null,
//       precision: null,
//       columnType: null,
//       cnName: '出货时间',
//       enName: '出货时间',
//       customColumnType: 'date',
//       fieldPermission: 'Y',
//       srcValue: null,
//       tableName: null,
//       isHidden: 0,
//       joinDataId: null,
//       sortBy: 0,
//       level: null,
//       levelName: null,
//       parentId: null,
//       isLeaf: null,
//     },
//     {
//       id: null,
//       dataId: null,
//       columnId: 'a64d069e7d5deba511e5a1201',
//       columnName: 'PAC毛利(USD)',
//       lowerColumnName: null,
//       upperColumnName: null,
//       columnTypeName: 'number',
//       columnClassName: 'java.lang.Long',
//       scale: null,
//       precision: null,
//       columnType: null,
//       cnName: 'PAC毛利(USD)',
//       enName: 'PAC毛利(USD)',
//       customColumnType: 'number',
//       fieldPermission: 'Y',
//       srcValue: null,
//       tableName: null,
//       isHidden: 0,
//       joinDataId: null,
//       sortBy: 0,
//       level: null,
//       levelName: null,
//       parentId: null,
//       isLeaf: null,
//     },
//     {
//       id: null,
//       dataId: null,
//       columnId: 'a64d069e7d5deba511e5a1202',
//       columnName: '销售收入(USD)',
//       lowerColumnName: null,
//       upperColumnName: null,
//       columnTypeName: 'number',
//       columnClassName: 'java.lang.Long',
//       scale: null,
//       precision: null,
//       columnType: null,
//       cnName: '销售收入(USD)',
//       enName: '销售收入(USD)',
//       customColumnType: 'number',
//       fieldPermission: 'Y',
//       srcValue: null,
//       tableName: null,
//       isHidden: 0,
//       joinDataId: null,
//       sortBy: 0,
//       level: null,
//       levelName: null,
//       parentId: null,
//       isLeaf: null,
//     },
//     {
//       id: null,
//       dataId: null,
//       columnId: 'a64d069e7d5deba511e5a1203',
//       columnName: '出货数量',
//       lowerColumnName: null,
//       upperColumnName: null,
//       columnTypeName: 'number',
//       columnClassName: 'java.lang.Long',
//       scale: null,
//       precision: null,
//       columnType: null,
//       cnName: '出货数量',
//       enName: '出货数量',
//       customColumnType: 'number',
//       fieldPermission: 'Y',
//       srcValue: null,
//       tableName: null,
//       isHidden: 0,
//       joinDataId: null,
//       sortBy: 0,
//       level: null,
//       levelName: null,
//       parentId: null,
//       isLeaf: null,
//     },
//     {
//       id: null,
//       dataId: null,
//       columnId: 'a64d069e7d5deba511e5a1205',
//       columnName: '分类',
//       lowerColumnName: null,
//       upperColumnName: null,
//       columnTypeName: 'string',
//       columnClassName: 'java.lang.String',
//       scale: null,
//       precision: null,
//       columnType: null,
//       cnName: '分类',
//       enName: '分类',
//       customColumnType: 'string',
//       fieldPermission: 'Y',
//       srcValue: null,
//       tableName: null,
//       isHidden: 0,
//       joinDataId: null,
//       sortBy: 0,
//       level: null,
//       levelName: null,
//       parentId: null,
//       isLeaf: null,
//     },
//     {
//       id: null,
//       dataId: null,
//       columnId: 'a64d069e7d5deba511e5a1206',
//       columnName: '立项名称',
//       lowerColumnName: null,
//       upperColumnName: null,
//       columnTypeName: 'string',
//       columnClassName: 'java.lang.String',
//       scale: null,
//       precision: null,
//       columnType: null,
//       cnName: '立项名称',
//       enName: '立项名称',
//       customColumnType: 'string',
//       fieldPermission: 'Y',
//       srcValue: null,
//       tableName: null,
//       isHidden: 0,
//       joinDataId: null,
//       sortBy: 0,
//       level: null,
//       levelName: null,
//       parentId: null,
//       isLeaf: null,
//     },
//     {
//       id: null,
//       dataId: null,
//       columnId: 'a64d069e7d5deba511e5a1207',
//       columnName: '立项年',
//       lowerColumnName: null,
//       upperColumnName: null,
//       columnTypeName: 'string',
//       columnClassName: 'java.lang.String',
//       scale: null,
//       precision: null,
//       columnType: null,
//       cnName: '立项年',
//       enName: '立项年',
//       customColumnType: 'string',
//       fieldPermission: 'Y',
//       srcValue: null,
//       tableName: null,
//       isHidden: 0,
//       joinDataId: null,
//       sortBy: 0,
//       level: null,
//       levelName: null,
//       parentId: null,
//       isLeaf: null,
//     },
//     {
//       id: null,
//       dataId: null,
//       columnId: 'a64d069e7d5deba511e5a1208',
//       columnName: '状态',
//       lowerColumnName: null,
//       upperColumnName: null,
//       columnTypeName: 'string',
//       columnClassName: 'java.lang.String',
//       scale: null,
//       precision: null,
//       columnType: null,
//       cnName: '状态',
//       enName: '状态',
//       customColumnType: 'string',
//       fieldPermission: 'Y',
//       srcValue: null,
//       tableName: null,
//       isHidden: 0,
//       joinDataId: null,
//       sortBy: 0,
//       level: null,
//       levelName: null,
//       parentId: null,
//       isLeaf: null,
//     },
//     {
//       id: null,
//       dataId: null,
//       columnId: 'a65bb3453d5de61850bf28c77',
//       columnName: 'CE_NUMBER',
//       lowerColumnName: null,
//       upperColumnName: null,
//       columnTypeName: 'string',
//       columnClassName: 'java.lang.String',
//       scale: null,
//       precision: null,
//       columnType: null,
//       cnName: 'CE_NUMBER',
//       enName: 'CE_NUMBER',
//       customColumnType: 'string',
//       fieldPermission: 'Y',
//       srcValue: null,
//       tableName: null,
//       isHidden: 0,
//       joinDataId: null,
//       sortBy: 0,
//       level: null,
//       levelName: null,
//       parentId: null,
//       isLeaf: null,
//     },
//   ],
//   chainId: '662f160ad5de53d68e2d32d8',
//   failed: false,
//   success: true,
// }

// export const mockData = {
//   code: 0,
//   msg: '请求成功',
//   data: {
//     headList: [
//       {
//         id: 'ae73e2721b43f4af7adb35d09e68a734e',
//         dataId: null,
//         columnId: 'ae73e2721b43f4af7adb35d09e68a734e',
//         columnName: 'ae73e2721b43f4af7adb35d09e68a734e',
//         lowerColumnName: 'ae73e2721b43f4af7adb35d09e68a734e',
//         upperColumnName: 'AE73E2721B43F4AF7ADB35D09E68A734E',
//         columnTypeName: 'CHAR',
//         columnClassName: 'java.lang.String',
//         scale: 0,
//         precision: 85,
//         columnType: 1,
//         cnName: '日期',
//         enName: 'SYNC_DATE',
//         customColumnType: 'string',
//         fieldPermission: null,
//         srcValue: null,
//         tableName: null,
//         isHidden: 0,
//         joinDataId: null,
//         sortBy: 0,
//         level: null,
//         levelName: null,
//         parentId: null,
//         isLeaf: null,
//       },
//       {
//         id: 'a85cd4a21d25049ffb120148060694e47',
//         dataId: null,
//         columnId: 'a85cd4a21d25049ffb120148060694e47',
//         columnName: 'a85cd4a21d25049ffb120148060694e47',
//         lowerColumnName: 'a85cd4a21d25049ffb120148060694e47',
//         upperColumnName: 'A85CD4A21D25049FFB120148060694E47',
//         columnTypeName: 'DECIMAL',
//         columnClassName: 'java.math.BigDecimal',
//         scale: 6,
//         precision: 38,
//         columnType: 3,
//         cnName: '组织',
//         enName: 'ORGANIZATION_ID',
//         customColumnType: 'double',
//         fieldPermission: null,
//         srcValue: null,
//         tableName: null,
//         isHidden: 0,
//         joinDataId: null,
//         sortBy: 0,
//         level: null,
//         levelName: null,
//         parentId: null,
//         isLeaf: null,
//       },
//     ],
//     dataList: [
//       {
//         ae73e2721b43f4af7adb35d09e68a734e: '2023-07-13',
//         a85cd4a21d25049ffb120148060694e47: '1234',
//       },
//       {
//         ae73e2721b43f4af7adb35d09e68a734e: '2023-07-14',
//         a85cd4a21d25049ffb120148060694e47: '2344',
//       },
//     ],
//     totalNum: 1,
//     httpOriginalResult: null,
//     emptyMsg: null,
//     extData: null,
//   },
//   chainId: '662f4657d5de0122d8d67c92',
//   success: true,
//   failed: false,
// }

import { composeValue } from './utils.js'

const isToolsShowConfig = {
  itemStyle: {
    opacity: 0,
  },
  lineStyle: {
    opacity: 0,
  },
}

// 计算  seriesData
export const calcData = ({ dimensionFields, quotaFields, data, chartType }) => {
  const { headList, dataList } = data
  const categoryData = [],
    dimensionLen = dimensionFields.length

  for (let i = dimensionLen - 1; i >= 0; i--) {
    let item = dimensionFields[i]
    let data = new Map()
    dataList.forEach(d => {
      let name = d[item.id]
      if (i === dimensionLen - 1) {
        name = dimensionFields.map(i => d[i.id]).join('_')
      }
      data.set(name, (data.get(name) ?? 0) + 1)
    })
    categoryData.push(data)
  }

  const seriesData = quotaFields.map(item => {
    let temp = {
      name: item.name || item.cnName,
      type: chartType,
      yAxisIndex: item.doubleYAxis ? 1 : 0,
      data: dataList.map((d, index) => {
        return {
          value: Number(d[item.id]),
          preTitle: dimensionFields
            .map(dimensionItem => {
              return dataList[index][dimensionItem.id]
            })
            .join('_'),
          data: item,
        }
      }),
    }

    if (item.isToolsShow) {
      temp = {
        ...temp,
        ...isToolsShowConfig,
      }
    }
    return temp
  })
  // console.log(categoryData, seriesData)

  return {
    getCategoryData: ({ position }) => {

      if(!categoryData.length) {
        return [{
          type: 'category',
        }]
      }

      return categoryData.map((item, index, arr) => {
        const data = [...item.keys()]
        return {
          type: 'category',
          position,
          axisLabel: {
            margin: 20 * (index + 1),
            formatter: value => {
              return value.split('_').at(-1)
            },
          },
          axisTick: {
            length: 30 * (index + 1),
            interval: function (index, value) {
              //   console.log(index, value)
            },
          },
          data,
        }
      })
    },
    seriesData,
  }
}


export const toolTipsFormatter = params => {
  let { name } = params[0]
  let tip = `${name}<br/>`
  params.forEach(item => {
    const {
      value,
      data: { data },
    } = item
    let valueText = composeValue({ val: value, item: data })
    tip += `<div style="display: flex; justify-content: space-between;"><span style="margin-right: 20px;">${item.marker}${item.seriesName}：</span><span>${valueText}</span></div>`
  })
  return tip
}

export const pieToolTipsFormatter = params => {
  let { seriesName } = params
  let tip = `${seriesName}<br/>`
  const {
    value,
    data: { data },
  } = params
  let valueText = composeValue({ val: value, item: data })
  tip += `<div style="display: flex; justify-content: space-between;"><span style="margin-right: 20px;">${params.marker}${params.name}：</span><span>${valueText}</span></div>`
  return tip
}

export const getToolTips = chartTyp => {
  return {
    trigger: ['pie'].includes(chartTyp) ? 'item' : 'axis',
    formatter: ['pie'].includes(chartTyp) ? pieToolTipsFormatter : toolTipsFormatter,
  }
}

export const getLegendData = quotaFields => {
  return quotaFields
    .filter(i => !i.isToolsShow)
    .map(item => item.name || item.cnName)
}

export const getPieAddTreeMapSeriesData = ({
  dimensionFields,
  quotaFields,
  data,
  chartType,
}) => {
  const { headList, dataList } = data
  const valueKey = quotaFields[0]?.id
  const seriesData = {
    type: chartType,
    name: dimensionFields.map(i => i.cnName).join('_'),
    data: dataList.map(item => {
      return {
        name: dimensionFields.map(i => item[i.id]).join('_'),
        value: item[valueKey],
      }
    }),
  }

  return {
    seriesData,
  }
}
